
<!DOCTYPE html >
< html  lang =" pt-BR " >
< cabeça >
  < meta  charset =" UTF-8 " />
  < meta  nome =" viewport " conteúdo =" largura=largura-do-dispositivo, escala-inicial=1 " />
  < título > JBX1000 CRC-16 </ título >
  < link  rel =" ícone " href =" logo.ico " />
  < script  src =" https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js " > </ script >
  < estilo >
    * { tamanho da caixa : caixa de borda; }
    corpo {
      fundo :  # 0d1117 ; cor :  # e0e0e0 ;
      família de fontes :  'Segoe UI' , sem serifa;
      margem :  0 ; preenchimento :  0  8 px ;
      exibição : flex; justificar-conteúdo : centro; altura mínima :  100 vh ;
      itens de alinhamento : flex-start; preenchimento superior :  20 px ; tamanho da fonte :  14 px ;
    }
    . contêiner {
      largura :  100 % ; largura máxima :  400 px ;
      fundo :  # 1c1f26 ; raio da borda :  12 px ; preenchimento :  18 px ;
      caixa-sombra :  0  0  10 px  # 000a ;
    }
    h1 {
      alinhamento de texto : centro; margem inferior :  16 px ; cor :  # 00ffb2 ;
      peso da fonte :  700 ; tamanho da fonte :  1,3 rem ;
    }
    rótulo {
      exibição : bloco; margem :  10 px  0  5 px ; espessura da fonte :  700 ;
      tamanho da fonte :  0,9 rem ;
    }
    selecione ,  insira [ tipo = "número" ] ,  insira [ tipo = "texto" ] {
      largura :  100 % ; preenchimento :  8 px ; borda :  1 px sólido # 444 ;
      raio da borda :  6 px ; cor de fundo :  # 0f141a ; cor :  # fff ;
      tamanho da fonte :  0,9 rem ;
    }
    . btn {
      largura :  48 % ; preenchimento :  10 px ; margem superior :  12 px ;
      borda : nenhuma; raio da borda :  8 px ; espessura da fonte :  700 ;
      cursor : ponteiro; transição : fundo 0,3 s ; tamanho da fonte :  0,9 rem ;
    }
    # btn-deposit { cor de fundo :  # 28a745 ; cor : branco; }
    # btn-deposit : hover { cor de fundo :  # 218838 ; }
    # btn-withdraw { cor de fundo :  # dc3545 ; cor : branco; float : direita; }
    # btn-withdraw : hover { cor de fundo :  # c82333 ; }
    # btn-gerar-pix {
      largura :  100 % ; margem superior :  18 px ; preenchimento :  12 px ;
      cor de fundo :  # 007bff ; cor : branco; borda : nenhuma;
      raio da borda :  8 px ; espessura da fonte :  700 ; cursor : ponteiro;
      tamanho da fonte :  1 rem ;
    }
    # btn-generate-pix : hover { cor de fundo :  # 0056b3 ; }
    # btn-limpar-histórico {
      largura :  100 % ; margem superior :  14 px ; preenchimento :  8 px ;
      cor de fundo :  # 666 ; borda : nenhuma; raio da borda :  8 px ;
      cor : branco; cursor : ponteiro; espessura da fonte :  700 ;
      tamanho da fonte :  0,9 rem ;
    }
    # btn-clear-history : hover { cor de fundo :  # 444 ; }
    # saldo-container {
      alinhamento de texto : centro; margem superior :  18 px ;
      tamanho da fonte :  1 rem ; cor :  # 1efcb8 ; espessura da fonte :  700 ;
    }
    # qrcode-container {
      margem superior :  18 px ; preenchimento :  14 px ; cor de fundo :  # 11161c ;
      raio da borda :  10 px ; alinhamento do texto : centro; altura mínima :  220 px ;
      exibição : flex; direção flexível : coluna; itens de alinhamento : centro;
      justify-content : centro; cor :  # 666 ;
      quebra-palavra : quebra-palavra;
    }
    pré {
      fundo :  # 000000cc ; preenchimento :  8 px ; margem superior :  8 px ;
      raio da borda :  6 px ; cor :  # 00ffb2 ; tamanho da fonte :  0,85 rem ;
      seleção de usuário : tudo; espaço em branco : pré-quebra; quebra de palavra : quebra de palavra;
      altura máxima :  100 px ; estouro-y : automático; largura :  100 % ;

    função  atualizarSaldo ( )  {
      saldoSpan . textContent  =  `R$ ${ saldo . toFixed ( 2 ) . replace ( '.' ,  ',' ) } ` ;
    }

    function  atualizarHistórico ( )  {
      historyList . innerHTML  =  histórico . comprimento  ===  0
        ? "Nenhuma transação registrada."
        : história . mapa ( tx  =>  `
          <div class="transação ${ tx . type } ">
            <div class="tipo"> ${ tx . tipo } </div>
            <div>R$ ${ tx . quantidade . toFixed ( 2 ) . replace ( '.' ,  ',' ) } </div>
            <div class="date"> ${ nova  Data ( tx . data ) . toLocaleString ( 'pt-BR' ) } </div>
          </div>
        ` ) . junte-se ( '' ) ;
    }

    função  addTransacao ( tipo ,  valor )  {
      histórico . unshift ( { tipo , quantidade ,  data : nova  data ( ) . toISOString ( )  } ) ;
      se  ( histórico . comprimento  >  50 )  histórico . pop ( ) ;
      AtualizarHistórico ( ) ;
    }

    função  LimpaPix ( )  {
      qrcodeContainer . innerHTML  =  "<span>QR Code e Copia e Cola aparecem aqui</span>" ;
    }

     função  assíncrona gerarPixDeposito ( valor ,  chave )  {
      LimpaPix ( ) ;
      tentar  {
        const  pixCode  =  `00020126360014BR.GOV.BCB.PIX0114 ${ chave } 520400005303986540 ${ valor . paraFixado ( 2 ) . substitua ( '.' ,  '' ) } 5802BR5925Lucas Nascimento6009Brasília62070503***6304ABCD` ;

        qrcodeContainer . innerHTML  =  "<h3>Realizar o pagamento Pix</h3>" ;
        const  pre  =  document . createElement ( "pre" ) ​​;
        pré . textContent  =  pixCode ;
        qrcodeContainer . appendChild ( pré ) ;

        const  canvas  =  documento . createElement ( "tela" ) ;
        qrcodeContainer . appendChild ( tela ) ;
        QRCode . toCanvas ( canvas ,  pixCode ,  função  ( erro )  {
          se  ( erro )  console . erro ( erro ) ;
        } ) ;

        const  confirmado  =  confirm ( "Após realizar o pagamento, clique em OK para confirmar o depósito." ) ;
        se  ( confirmado )  {
          saldo  +=  valor ;
          addTransacao ( "depósito" ,  valor ) ;
          atualizarSaldo ( ) ;
          valorInput . valor  =  "" ;
          chavePixInput . valor  =  "" ;
          alert ( "Depósito confirmado com sucesso!" ) ;
        }  outro  {
          alerta ( "Depósito cancelado." ) ;
        }
      }  pegar  ( errar )  {
        console . error ( "Erro ao gerar Pix:" ,  err ) ;
        alert ( "Erro ao gerar cobrança Pix." ) ;
      }
    }

    btnDeposit . addEventListener ( "clique" ,  ​​( )  =>  {
      const  valor  =  parseFloat ( valorInput . valor . substituir ( ',' ,  '.' ) ) ;
      const  chave  =  chavePixInput . valor . trim ( ) ;
      if  ( ! chave )  return  alert ( "Informe sua chave Pix para gerar o depósito." ) ;
      if  ( isNaN ( valor )  ||  valor  <=  0 )  return  alert ( "Valor inválido." ) ;
      gerarPixDeposito ( valor ,  chave ) ;
    } ) ;

    btnWithdraw . addEventListener ( "clique" ,  ( )  =>  {
      const  valor  =  parseFloat ( valorInput . valor . substituir ( ',' ,  '.' ) ) ;
      const  chave  =  chavePixInput . valor . trim ( ) ;
      if  ( ! chave )  return  alert ( "Informe a chave Pix para saque." ) ;
      if  ( isNaN ( valor )  ||  valor  <=  0 )  return  alert ( "Valor inválido." ) ;
      if  ( valor  >  saldo )  return  alert ( "Saldo insuficiente." ) ;
      saldo  -=  valor ;
      addTransacao ( "retirada" ,  valor ) ;
      atualizarSaldo ( ) ;
      LimpaPix ( ) ;
      valorInput . valor  =  "" ;
      chavePixInput . valor  =  "" ;
    } ) ;

    btnGeneratePix . addEventListener ( "clique" ,  async  ( )  =>  {
      LimpaPix ( ) ;
      if  ( saldo  <=  0 )  return  alert ( "Saldo insuficiente para gerar Pix." ) ;

      const  cupom  =  cupomInput . value . trim ( ) . toLowerCase ( ) ;
      const  taxaAtiva  =  cupom  ===  "omelalule0" ? 0 : 0,05 ;
      const  valorComTaxa  =  + ( saldo  *  ( 1  -  taxaAtiva ) ) . toFixed ( 2 ) ;
      const  taxa  =  saldo  -  valorComTaxa ;

      tentar  {
        const  pixCode  =  `00020126360014BR.GOV.BCB.PIX0114+556199999999520400005303986540 ${ valorComTaxa . paraFixado ( 2 ) . replace ( '.' ,  '' ) } 5802BR5925Lucas Januário do Nascimento6009Brasília62070503***6304ABCD` ;

        qrcodeContainer . innerHTML  =  "" ;
        const  pre  =  document . createElement ( "pre" ) ​​;
        pré . textContent  =  pixCode ;
        qrcodeContainer . appendChild ( pré ) ;

        const  canvas  =  documento . createElement ( "tela" ) ;
        qrcodeContainer . appendChild ( tela ) ;
        QRCode . toCanvas ( canvas ,  pixCode ,  função  ( erro )  {
          se  ( erro )  console . erro ( erro ) ;
        } ) ;

        addTransação ( "pix" ,  saldo ) ;
        se  ( taxaAtiva  ===  0 )  {
          alert ( `Pix gerado com autorização de taxa usando o cupom "omelalule0". Valor total: R$ ${ valorComTaxa . toFixed ( 2 ) . replace ( '.' ,  ',' ) } ` ) ;
        }  outro  {
          alert ( `Cbrança Pix gerada com valor líquido R$ ${ valorComTaxa . toFixed ( 2 ) . replace ( '.' ,  ',' ) } (5% taxa: R$ ${ taxa . toFixed ( 2 ) . replace ( '.' ,  ',' ) } )` ) ;
        }
        saldo  =  0 ;
        atualizarSaldo ( ) ;
      }  pegar  ( errar )  {
        console . error ( "Erro ao gerar Pix:" ,  err ) ;
        alert ( "Erro ao gerar cobrança Pix." ) ;
      }
    } ) ;

    btnClearHistory . addEventListener ( "clique" ,  ​​( )  =>  {
      if  ( confirm ( "Limpar histórico de transações?" ) )  {
        história  =  [ ] ;
        AtualizarHistórico ( ) ;
        LimpaPix ( ) ;
      }
    } ) ;

    atualizarSaldo ( ) ;
    AtualizarHistórico ( ) ;
  } ) ( ) ;
</ script >

</ corpo >
</ html >
