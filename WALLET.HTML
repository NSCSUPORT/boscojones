<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JBX Wallet</title>
  <link rel="icon" href="logo.ico" />
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body {
      background: #0d1117;
      color: #e0e0e0;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 16px;
    }
    .container {
      width: 100%;
      max-width: 420px;
      background: #1b1f24;
      border: 1px solid #2a2f36;
      border-radius: 12px;
      padding: 24px;
      box-sizing: border-box;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #fff;
      font-size: 1.5rem;
    }
    label {
      font-weight: 600;
      margin-top: 12px;
      display: block;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #444c56;
      border-radius: 8px;
      background: #10151b;
      color: #fff;
      font-size: 1rem;
    }
    .btn {
      width: 48%;
      padding: 12px;
      font-weight: 700;
      border: none;
      border-radius: 10px;
      margin-top: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #btn-deposit { background: #237a3b; color: #fff; }
    #btn-deposit:hover { background: #195c2c; }
    #btn-withdraw { background: #9d2c2c; color: #fff; float: right; }
    #btn-withdraw:hover { background: #6e1f1f; }
    #btn-generate-pix {
      width: 100%;
      background: #1d4c8b;
      color: #fff;
      margin-top: 24px;
      padding: 12px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
    }
    #btn-generate-pix:hover { background: #163a6a; }
    #qrcode-container {
      margin-top: 20px;
      padding: 16px;
      background: #0e1217;
      border-radius: 12px;
      text-align: center;
    }
    #saldo-container {
      margin-top: 20px;
      text-align: center;
      font-size: 1.2rem;
      color: #a0d6b4;
      font-weight: bold;
    }
    pre {
      background: #0e1217;
      padding: 10px;
      border-radius: 8px;
      overflow-x: auto;
      color: #d1dbe5;
      font-size: 0.95rem;
      user-select: all;
    }
    @media(max-width: 400px) {
      .btn { width: 100%; margin-top: 10px; float: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Carteira JBX1000</h1>

    <label for="valor">Valor (R$):</label>
    <input type="number" id="valor" placeholder="0,00" min="1" step="0.01" />

    <button id="btn-deposit" class="btn">Depositar</button>
    <button id="btn-withdraw" class="btn">Sacar</button>

    <button id="btn-generate-pix">Gerar Pix Copia e Cola (5% taxa)</button>

    <div id="saldo-container">Saldo: R$ <span id="saldo">0.00</span></div>

    <div id="qrcode-container">
      <span>QR Code e Copia e Cola aparecerão aqui</span>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "jbx1000_wallet_saldo";
    let saldoAtual = parseFloat(localStorage.getItem(STORAGE_KEY)) || 0;

    function atualizarSaldoNaTela() {
      document.getElementById("saldo").innerText = saldoAtual.toFixed(2);
    }

    function validarValor() {
      const val = parseFloat(document.getElementById('valor').value.replace(',', '.'));
      if (isNaN(val) || val <= 0) {
        alert("Informe um valor válido.");
        return null;
      }
      return val;
    }

    function limparInputs() {
      document.getElementById('valor').value = '';
    }

    function limparQRCode() {
      document.getElementById('qrcode-container').innerHTML = `<span>QR Code e Copia e Cola aparecerão aqui</span>`;
    }

    document.getElementById('btn-deposit').onclick = () => {
      const valor = validarValor();
      if (valor === null) return;

      const fatorGem = 89;
      const valorFinal = valor * fatorGem;

      saldoAtual += valorFinal;
      localStorage.setItem(STORAGE_KEY, saldoAtual.toFixed(2));

      alert(`Depósito com Geminiosidade x${fatorGem}\nTotal creditado: R$ ${valorFinal.toFixed(2)}`);
      atualizarSaldoNaTela();
      limparInputs();
      limparQRCode();
    };

    document.getElementById('btn-withdraw').onclick = () => {
      const valor = validarValor();
      if (valor === null) return;

      if (valor > saldoAtual) {
        alert("Saldo insuficiente.");
        return;
      }

      saldoAtual -= valor;
      localStorage.setItem(STORAGE_KEY, saldoAtual.toFixed(2));

      alert(`Saque de R$ ${valor.toFixed(2)} realizado com sucesso.`);
      atualizarSaldoNaTela();
      limparInputs();
      limparQRCode();
    };

    document.getElementById('btn-generate-pix').onclick = () => {
      const valor = validarValor();
      if (valor === null) return;

      const taxa = 1.05;
      const valorComTaxa = (valor * taxa).toFixed(2);
      const chavePix = "48761013889";
      const nome = "JBX Wallet";
      const cidade = "SAO PAULO";
      const txid = "TXID123";

      // Payload Pix Copia e Cola (simplificado)
      const payload = `
000201
26580014BR.GOV.BCB.PIX0139487610138895204000053039865405${valorComTaxa}
5802BR5912${nome}6009${cidade}62070503${txid}6304
      `.replace(/\n/g, '').replace(/ +/g, '');

      // Mostrar QR e Copia e Cola
      const container = document.getElementById('qrcode-container');
      container.innerHTML = '';
      QRCode.toCanvas(payload, { width: 200 }, (err, canvas) => {
        if (err) {
          alert('Erro ao gerar QR Code');
          limparQRCode();
          return;
        }
        container.appendChild(canvas);

        const pre = document.createElement('pre');
        pre.innerText = payload;
        container.appendChild(pre);
      });

      // Atualiza saldo com Geminiosidade
      const fatorGem = 89;
      const valorFinal = valor * fatorGem;
      saldoAtual += valorFinal;
      localStorage.setItem(STORAGE_KEY, saldoAtual.toFixed(2));
      atualizarSaldoNaTela();

      alert(`Pix gerado com Geminiosidade x${fatorGem}\nSaldo creditado: R$ ${valorFinal.toFixed(2)}`);
    };

    atualizarSaldoNaTela();
    limparQRCode();
  </script>
</body>
</html>
