<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>JBX500 Wallet - Supabase</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { background: #0d1117; color: #c9d1d9; font-family: Arial, sans-serif; padding: 20px; }
    .container { max-width: 480px; margin: auto; background: #161b22; padding: 24px; border-radius: 12px; }
    h1 { color: #58a6ff; text-align: center; }
    label, input, select { display: block; width: 100%; margin-top: 12px; font-size: 1rem; }
    input, select { padding: 10px; background: #0d1117; color: #c9d1d9; border: 1px solid #30363d; border-radius: 6px; }
    .btn { margin-top: 24px; padding: 12px; font-size: 1rem; width: 48%; border-radius: 8px; border: none; cursor: pointer; }
    #btn-deposit { background: linear-gradient(135deg, #4caf50, #81c784); color: #fff; float: left; }
    #btn-withdraw { background: linear-gradient(135deg, #f44336, #e57373); color: #fff; float: right; }
    #saldo-container { text-align: center; margin-top: 20px; color: #00ff88; font-size: 1.2rem; }
    #qrcode-container { clear: both; margin-top: 30px; text-align: center; }
  </style>
</head>
<body>
  <h1>JBX500 Wallet</h1>
  <div class="container">
    <label>Ativo:</label>
    <select id="asset-select">
      <option value="">Selecione</option>
      <option value="JBX500">JBX500</option>
    </select>

    <label>Valor (R$):</label>
    <input type="number" id="valor" min="1" step="0.01" placeholder="0.00" />

    <label>Geminiosidade (%): <span id="gem-value">0</span>%</label>
    <input type="range" id="gem" min="0" max="10" value="0" />

    <button id="btn-deposit" class="btn">Depositar</button>
    <button id="btn-withdraw" class="btn">Sacar</button>

    <div id="saldo-container">Saldo: R$ <span id="saldo">0.00</span></div>
    <div id="qrcode-container"></div>
  </div>

<script>
const supabase = supabase.createClient(
  'https://latvlqeqjtlawtzmgzjb.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxhdHZscWVxanRsYXd0em1nempiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAxMDcxNTIsImV4cCI6MjA2NTY4MzE1Mn0.jxtGxvyP9k9NpldwD8KP7km0fOipftHXMic3dqJEIaY'
);

let userEmail = "teste@jbwallet.com"; // substitua por auth real se desejar
let saldoAtual = 0;

async function carregarSaldo() {
  const { data, error } = await supabase.from('wallets').select('*').eq('email', userEmail).single();
  if (data) {
    saldoAtual = data.saldo || 0;
    document.getElementById('saldo').innerText = saldoAtual.toFixed(2);
  } else {
    await supabase.from('wallets').insert([{ email: userEmail, saldo: 0 }]);
  }
}

function fibonacci(n) {
  if (n <= 1) return 1;
  let a = 1, b = 1;
  for (let i = 2; i <= n; i++) [a, b] = [b, a + b];
  return b;
}

document.getElementById('gem').addEventListener('input', e => {
  document.getElementById('gem-value').innerText = e.target.value;
});

document.getElementById('btn-deposit').onclick = async () => {
  const valor = parseFloat(document.getElementById('valor').value);
  const gem = parseInt(document.getElementById('gem').value);
  const fibo = fibonacci(gem);
  const final = valor * fibo;
  saldoAtual += final;
  await supabase.from('wallets').update({ saldo: saldoAtual }).eq('email', userEmail);
  alert(`Deposito feito com Geminiosidade x${fibo}\nValor creditado: R$ ${final.toFixed(2)}`);
  document.getElementById('saldo').innerText = saldoAtual.toFixed(2);
};

document.getElementById('btn-withdraw').onclick = async () => {
  const valor = parseFloat(document.getElementById('valor').value);
  if (valor > saldoAtual) return alert('Saldo insuficiente');
  saldoAtual -= valor;
  await supabase.from('wallets').update({ saldo: saldoAtual }).eq('email', userEmail);
  alert(`Saque de R$ ${valor.toFixed(2)} solicitado com sucesso.\n\n⚠️ Será processado em até 24 horas.`);
  document.getElementById('saldo').innerText = saldoAtual.toFixed(2);
};

carregarSaldo();
</script>
</body>
</html>
