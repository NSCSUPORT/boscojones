<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Carteira Simples - Tudo em 1</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    background: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  h1 {
    margin-bottom: 10px;
  }
  .container {
    background: #222;
    padding: 20px;
    border-radius: 8px;
    width: 320px;
  }
  label {
    display: block;
    margin-top: 10px;
  }
  input[type="text"], input[type="password"], input[type="number"] {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    border-radius: 4px;
    border: none;
    font-size: 1rem;
  }
  button {
    margin-top: 15px;
    padding: 10px;
    width: 100%;
    font-weight: bold;
    font-size: 1rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    background-color: #4caf50;
    color: white;
    transition: background-color 0.3s;
  }
  button:hover {
    background-color: #45a049;
  }
  .btn-danger {
    background-color: #f44336;
  }
  .btn-danger:hover {
    background-color: #d32f2f;
  }
  .hidden {
    display: none;
  }
  .nav-buttons {
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
  }
  .nav-buttons button {
    width: 48%;
    background-color: #1a73e8;
  }
  .nav-buttons button:hover {
    background-color: #155ab6;
  }
  .error {
    background: #f44336;
    padding: 8px;
    margin-top: 10px;
    border-radius: 4px;
    color: white;
    font-weight: bold;
    text-align: center;
  }
  .success {
    background: #4caf50;
    padding: 8px;
    margin-top: 10px;
    border-radius: 4px;
    color: white;
    font-weight: bold;
    text-align: center;
  }
  .balance {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 15px 0;
    text-align: center;
  }
  table {
    width: 100%;
    margin-top: 15px;
    border-collapse: collapse;
    font-size: 0.9rem;
  }
  th, td {
    padding: 8px;
    border-bottom: 1px solid #444;
    text-align: left;
  }
  th {
    background-color: #333;
  }
</style>
</head>
<body>

<h1>Carteira Simples</h1>

<div class="container">

  <div class="nav-buttons">
    <button id="btn-show-login">Login</button>
    <button id="btn-show-register">Registrar</button>
  </div>

  <!-- Formulário Registrar -->
  <form id="form-register">
    <label for="reg-username">Usuário:</label>
    <input type="text" id="reg-username" required />

    <label for="reg-password">Senha:</label>
    <input type="password" id="reg-password" required />

    <button type="submit">Registrar</button>
  </form>

  <!-- Formulário Login -->
  <form id="form-login" class="hidden">
    <label for="login-username">Usuário:</label>
    <input type="text" id="login-username" required />

    <label for="login-password">Senha:</label>
    <input type="password" id="login-password" required />

    <button type="submit">Login</button>
  </form>

  <!-- Área após login -->
  <div id="wallet-section" class="hidden">
    <div class="balance">Saldo: R$ <span id="balance-value">0.00</span></div>

    <form id="form-deposit">
      <label for="deposit-amount">Depositar valor (R$):</label>
      <input type="number" id="deposit-amount" min="0.01" step="0.01" required />
      <button type="submit">Depositar</button>
    </form>

    <form id="form-withdraw">
      <label for="withdraw-amount">Sacar valor (R$):</label>
      <input type="number" id="withdraw-amount" min="0.01" step="0.01" required />
      <button type="submit" class="btn-danger">Sacar</button>
    </form>

    <button id="btn-logout" class="btn-danger" style="margin-top:20px;">Sair</button>

    <h3>Histórico de Transações</h3>
    <table id="transactions-table">
      <thead>
        <tr>
          <th>Data/Hora</th>
          <th>Tipo</th>
          <th>Valor (R$)</th>
        </tr>
      </thead>
      <tbody>
        <!-- Transações aparecerão aqui -->
      </tbody>
    </table>
  </div>

  <div id="message" class="hidden"></div>

</div>

<script>
  // Referências
  const btnShowLogin = document.getElementById('btn-show-login');
  const btnShowRegister = document.getElementById('btn-show-register');
  const formRegister = document.getElementById('form-register');
  const formLogin = document.getElementById('form-login');
  const walletSection = document.getElementById('wallet-section');
  const balanceValue = document.getElementById('balance-value');
  const formDeposit = document.getElementById('form-deposit');
  const formWithdraw = document.getElementById('form-withdraw');
  const transactionsTableBody = document.querySelector('#transactions-table tbody');
  const btnLogout = document.getElementById('btn-logout');
  const messageBox = document.getElementById('message');

  // Estado usuário logado
  let currentUser = null;

  // Mostrar mensagem
  function showMessage(text, type = 'error') {
    messageBox.textContent = text;
    messageBox.className = type === 'error' ? 'error' : 'success';
    messageBox.classList.remove('hidden');
    setTimeout(() => {
      messageBox.classList.add('hidden');
      messageBox.textContent = '';
    }, 4000);
  }

  // Alterna entre formularios de login e registro
  btnShowLogin.onclick = () => {
    formRegister.classList.add('hidden');
    formLogin.classList.remove('hidden');
    walletSection.classList.add('hidden');
    messageBox.classList.add('hidden');
  };
  btnShowRegister.onclick = () => {
    formLogin.classList.add('hidden');
    formRegister.classList.remove('hidden');
    walletSection.classList.add('hidden');
    messageBox.classList.add('hidden');
  };

  // Salvar usuário no localStorage
  function saveUser(user) {
    localStorage.setItem('user_' + user.username, JSON.stringify(user));
  }
  // Buscar usuário
  function getUser(username) {
    const userJSON = localStorage.getItem('user_' + username);
    if (!userJSON) return null;
    return JSON.parse(userJSON);
  }

  // Atualizar saldo na interface
  function updateBalance() {
    if (!currentUser) return;
    balanceValue.textContent = currentUser.balance.toFixed(2);
  }

  // Atualizar histórico na interface
  function updateTransactionHistory() {
    if (!currentUser) return;
    transactionsTableBody.innerHTML = '';
    currentUser.transactions.forEach(tx => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${new Date(tx.date).toLocaleString()}</td>
        <td>${tx.type}</td>
        <td>R$ ${tx.amount.toFixed(2)}</td>
      `;
      transactionsTableBody.appendChild(tr);
    });
  }

  // Login
  formLogin.addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('login-username').value.trim();
    const password = document.getElementById('login-password').value.trim();
    const user = getUser(username);
    if (!user || user.password !== password) {
      showMessage('Usuário ou senha inválidos.');
      return;
    }
    currentUser = user;
    formLogin.reset();
    showWallet();
    showMessage('Login realizado com sucesso!', 'success');
  });

  // Registrar
  formRegister.addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('reg-username').value.trim();
    const password = document.getElementById('reg-password').value.trim();
    if (getUser(username)) {
      showMessage('Usuário já existe.');
      return;
    }
    if (username === '' || password === '') {
      showMessage('Preencha todos os campos.');
      return;
    }
    const newUser = {
      username,
      password,
      balance: 0,
      transactions: []
    };
    saveUser(newUser);
    showMessage('Usuário registrado com sucesso! Agora faça login.', 'success');
    formRegister.reset();
    formRegister.classList.add('hidden');
    formLogin.classList.remove('hidden');
  });

  // Exibe a área da carteira
  function showWallet() {
    formLogin.classList.add('hidden');
    formRegister.classList.add('hidden');
    walletSection.classList.remove('hidden');
    updateBalance();
    updateTransactionHistory();
  }

  // Deposit
  formDeposit.addEventListener('submit', e => {
    e.preventDefault();
    const amount = parseFloat(document.getElementById('deposit-amount').value);
    if (isNaN(amount) || amount <= 0) {
      showMessage('Valor inválido para depósito.');
      return;
    }
    currentUser.balance += amount;
    currentUser.transactions.unshift({
      type: 'Depósito',
      amount,
      date: Date.now()
    });
    saveUser(currentUser);
    updateBalance();
    updateTransactionHistory();
    formDeposit.reset();
    showMessage('Depósito realizado com sucesso!', 'success');
  });

  // Withdraw
  formWithdraw.addEventListener('submit', e => {
    e.preventDefault();
    const amount = parseFloat(document.getElementById('withdraw-amount').value);
    if (isNaN(amount) || amount <= 0) {
      showMessage('Valor inválido para saque.');
      return;
    }
    if (amount > currentUser.balance) {
      showMessage('Saldo insuficiente para saque.');
      return;
    }
    currentUser.balance -= amount;
    currentUser.transactions.unshift({
      type: 'Saque',
      amount,
      date: Date.now()
    });
    saveUser(currentUser);
    updateBalance();
    updateTransactionHistory();
    formWithdraw.reset();
    showMessage('Saque realizado com sucesso!', 'success');
  });

  // Logout
  btnLogout.addEventListener('click', () => {
    currentUser = null;
    walletSection.classList.add('hidden');
    formLogin.classList.remove('hidden');
    showMessage('Você saiu.');
  });

  // Início: mostra login
  btnShowLogin.click();
</script>

</body>
</html>
